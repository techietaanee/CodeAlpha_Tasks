# -*- coding: utf-8 -*-
"""codealpha_sales_prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1od4SgKVjetkZ_XIdSnD4FvG14NSbPliv
"""

# ==========================================================
# TASK 4: SALES PREDICTION USING PYTHON
# CodeAlpha Internship
# ==========================================================

# -----------------------------
# 1. Import Libraries
# -----------------------------
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler, OneHotEncoder
from sklearn.compose import ColumnTransformer
from sklearn.pipeline import Pipeline
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_squared_error, r2_score

# -----------------------------
# 2. Load Dataset
# -----------------------------
# Corrected file path
path = "/content/drive/MyDrive/Colab Notebooks/Advertising.csv"
df = pd.read_csv(path)

print("Dataset Loaded Successfully from:", path)
print(df.head())
print(df.info())

# -----------------------------
# 3. Data Cleaning
# -----------------------------

# Remove extra spaces
df.columns = df.columns.str.strip()

# Handle missing values
df = df.dropna()

# -----------------------------
# 4. Feature Selection
# -----------------------------

# Target variable
y = df['Sales']

# Features (adjust if needed)
X = df.drop(columns=['Sales', 'Unnamed:_0'], errors='ignore') # Dropping 'Unnamed:_0' if it exists

# Separate numerical and categorical columns
num_cols = X.select_dtypes(include=['int64', 'float64']).columns
cat_cols = X.select_dtypes(include=['object']).columns

# -----------------------------
# 5. Preprocessing Pipeline
# -----------------------------
preprocessor = ColumnTransformer([
    ('num', StandardScaler(), num_cols),
    ('cat', OneHotEncoder(handle_unknown='ignore'), cat_cols)
])

# -----------------------------
# 6. Train-Test Split
# -----------------------------
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

# -----------------------------
# 7. Model Training
# -----------------------------
model = Pipeline([
    ('preprocessor', preprocessor),
    ('regressor', LinearRegression())
])

model.fit(X_train, y_train)

# -----------------------------
# 8. Model Evaluation
# -----------------------------
y_pred = model.predict(X_test)

rmse = np.sqrt(mean_squared_error(y_test, y_pred))
r2 = r2_score(y_test, y_pred)

print("\nMODEL PERFORMANCE")
print("RMSE:", rmse)
print("R2 Score:", r2)

# -----------------------------
# 9. Actual vs Predicted Sales
# -----------------------------
plt.figure(figsize=(7,5))
plt.scatter(y_test, y_pred)
plt.xlabel("Actual Sales")
plt.ylabel("Predicted Sales")
plt.title("Actual vs Predicted Sales")
plt.grid()
plt.show()

# -----------------------------
# 10. Advertising Impact Analysis
# -----------------------------
# Example: increase ad budget by 10%
X_new = X_test.copy()

for col in num_cols:
    X_new[col] = X_new[col] * 1.10

new_pred = model.predict(X_new)

impact = np.mean(new_pred - y_pred)
print("\nEstimated average sales increase after 10% ad budget increase:", impact)

# -----------------------------
# 11. Business Insights
# -----------------------------
print("\nBUSINESS INSIGHTS:")
print("1. Sales increase with higher advertising spend.")
print("2. Marketing platforms significantly affect sales.")
print("3. Optimizing ad budget can improve revenue.")
print("4. Data-driven marketing decisions improve ROI.")

print("\nTASK 4 COMPLETED SUCCESSFULLY")